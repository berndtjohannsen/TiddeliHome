<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Google Calendar — Events For One Day</title>
  <script src="https://accounts.google.com/gsi/client"></script>
  <style>
    body { font-family: sans-serif; padding: 2rem; }
    button { padding: .5rem 1rem; }
    pre { background:#f4f4f4; padding:1rem; white-space: pre-wrap; }
    .error { color: #b00020; }
    .ok { color: #006400; }
  </style>
</head>
<body>
<h2>Google Calendar Events</h2>
<p>Enter a date, authorize, and view your events for that day.</p>

<input type="date" id="date" />
<button id="btn">Load Events</button>

<pre id="output"></pre>

<script>
const CLIENT_ID = "297656229711-sbm00qend0blbhhbhajgkbacaepbiie8.apps.googleusercontent.com";
const SCOPES = "https://www.googleapis.com/auth/calendar.readonly";

let tokenClient = null;
let accessToken = null;

const out = (msg, cls) => {
  const el = document.getElementById('output');
  el.className = cls || '';
  el.textContent = msg;
};

async function initClient() {
  out('Initializing…');
  if (!window.google || !google.accounts || !google.accounts.oauth2) {
    out('Sandbox mode: Google OAuth unavailable here. Download file and run via http://localhost for full functionality.', 'error');
    return;
  }

  tokenClient = google.accounts.oauth2.initTokenClient({
    client_id: CLIENT_ID,
    scope: SCOPES,
    callback: (tokenResponse) => {
      accessToken = tokenResponse.access_token;
      out('Authorized. Fetching events…', 'ok');
      loadEvents();
    }
  });

  out('Ready. Pick a date and click Load Events.', 'ok');
}

window.addEventListener('load', initClient);

const btn = document.getElementById('btn');
btn.addEventListener('click', () => {
  if (!tokenClient && !accessToken) {
    const date = document.getElementById('date').value;
    if (!date) return out('Select a date first.', 'error');
    out('Sandbox mode: OAuth not available in preview. Download and run via http://localhost to fetch real events.', 'error');
    return;
  }
  loadEvents();
});

async function loadEvents() {
  if (!accessToken) {
    tokenClient.requestAccessToken();
    return;
  }

  const date = document.getElementById('date').value;
  if (!date) return out('Select a date first.', 'error');

  const start = new Date(date);
  const end = new Date(date);
  end.setDate(end.getDate() + 1);

  const url = `https://www.googleapis.com/calendar/v3/calendars/primary/events` +
    `?timeMin=${start.toISOString()}` +
    `&timeMax=${end.toISOString()}` +
    `&singleEvents=true&orderBy=startTime`;

  const res = await fetch(url, { headers: { Authorization: 'Bearer ' + accessToken } });
  const data = await res.json();

  out(
    data.items?.length
      ? data.items.map(e => `${e.start.dateTime || e.start.date} — ${e.summary || '(no title)'}`).join("\n")
      : 'No events found.',
    'ok'
  );
}
</script>
</body>
</html>
