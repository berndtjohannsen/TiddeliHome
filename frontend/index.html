<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TiddeliHome</title>
    
    <!-- Favicons -->
    <link rel="icon" type="image/x-icon" href="/icons/favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon.png">
    
    <!-- Web App Manifest -->
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#2A2A2A">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="TiddeliHome">
</head>
<body class="phone-ui-container">
    <!-- Overlay for settings panel -->
    <div class="settings-overlay fixed top-0 left-0 right-0 bottom-0 bg-black/50 z-[999] opacity-0 invisible" id="settings-overlay"></div>
    
    <!-- Settings Panel -->
    <div class="settings-panel fixed top-0 w-full max-w-[400px] h-screen bg-white shadow-[-4px_0_20px_rgba(0,0,0,0.2),-2px_0_10px_rgba(0,0,0,0.14)] z-[1000] flex flex-col overflow-hidden" id="settings-panel">
        <div class="flex justify-between items-center p-4 border-b border-gray-300 bg-white">
            <h2 class="text-gray-900 text-xl font-medium">Settings</h2>
            <button class="settings-close-btn" id="settings-close-btn" aria-label="Close settings">‚úï</button>
        </div>
        
        <div class="flex border-b border-gray-300 bg-white">
            <button class="settings-tab" data-tab="gemini">Gemini</button>
            <button class="settings-tab" data-tab="homeassistant">Home Assistant</button>
            <button class="settings-tab" data-tab="docs">Docs</button>
            <button class="settings-tab" data-tab="debug">Debug</button>
        </div>
        
        <!-- Gemini Tab Content -->
        <div class="settings-tab-content active" id="gemini-tab">
            <div class="mb-6">
                <label class="block text-gray-900 text-sm mb-2 text-left font-medium" for="gemini-api-key">
                    API Key <span class="text-red-500">*</span>:
                </label>
                <input 
                    type="password"
                    id="gemini-api-key" 
                    class="settings-input w-full p-3 border border-gray-300 rounded bg-white text-gray-900 text-sm box-border transition-colors duration-200 focus:outline-none focus:border-blue-500" 
                    placeholder="Enter your Gemini API key"
                />
                <p class="text-xs text-gray-600 mt-2 text-left leading-relaxed">
                    Required. Get your API key from <a href="https://aistudio.google.com/app/apikey" target="_blank" class="text-blue-500 hover:underline">Google AI Studio</a>
                </p>
            </div>

            <div class="mb-6">
                <label class="block text-gray-900 text-sm mb-2 text-left font-medium" for="gemini-model">
                    Model:
                </label>
                <input 
                    type="text"
                    id="gemini-model" 
                    class="settings-input w-full p-3 border border-gray-300 rounded bg-white text-gray-900 text-sm box-border transition-colors duration-200 focus:outline-none focus:border-blue-500" 
                    placeholder="gemini-2.5-flash-native-audio-preview-09-2025"
                />
                <p class="text-xs text-gray-600 mt-2 text-left leading-relaxed">
                    Gemini model name for audio interactions
                </p>
            </div>

            <div class="mb-6">
                <label class="block text-gray-900 text-sm mb-2 text-left font-medium" for="gemini-voice-name">
                    Voice Name:
                </label>
                <input 
                    type="text"
                    id="gemini-voice-name" 
                    class="settings-input w-full p-3 border border-gray-300 rounded bg-white text-gray-900 text-sm box-border transition-colors duration-200 focus:outline-none focus:border-blue-500" 
                    placeholder="e.g., Aoede, Charon, Fenrir"
                />
                <p class="text-xs text-gray-600 mt-2 text-left leading-relaxed">
                    Voice name for the AI (optional, leave empty for default)
                </p>
            </div>

            <div class="mb-6">
                <label class="block text-gray-900 text-sm mb-2 text-left font-medium" for="gemini-language-code">
                    Language Code:
                </label>
                <input 
                    type="text"
                    id="gemini-language-code" 
                    class="settings-input w-full p-3 border border-gray-300 rounded bg-white text-gray-900 text-sm box-border transition-colors duration-200 focus:outline-none focus:border-blue-500" 
                    placeholder="e.g., sv-SE, en-US"
                />
                <p class="text-xs text-gray-600 mt-2 text-left leading-relaxed">
                    Language code for AI responses (optional, leave empty for default)
                </p>
            </div>

            <div class="mb-6">
                <label class="flex items-center text-gray-900 text-sm mb-2 cursor-pointer">
                    <input type="checkbox" id="gemini-enable-grounding" class="mr-2 w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500" />
                    Enable Grounding
                </label>
                <p class="text-xs text-gray-600 mt-1 text-left leading-relaxed ml-6">
                    Enable Google Grounding for fact-checked responses
                </p>
            </div>

            <div class="mb-6">
                <label class="flex items-center text-gray-900 text-sm mb-2 cursor-pointer">
                    <input type="checkbox" id="gemini-enable-affective-dialog" class="mr-2 w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500" />
                    Enable Affective Dialog
                </label>
                <p class="text-xs text-gray-600 mt-1 text-left leading-relaxed ml-6">
                    Enable emotional tone adaptation in responses
                </p>
            </div>

            <div class="mb-6">
                <label class="flex items-center text-gray-900 text-sm mb-2 cursor-pointer">
                    <input type="checkbox" id="gemini-proactive-audio" class="mr-2 w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500" />
                    Proactive Audio
                </label>
                <p class="text-xs text-gray-600 mt-1 text-left leading-relaxed ml-6">
                    Allow AI to initiate audio without user prompt
                </p>
            </div>

            <div class="mb-6 border-t border-gray-300 pt-4">
                <h3 class="text-gray-900 text-base font-medium mb-3">Thinking Configuration</h3>
                <div class="mb-4">
                    <label class="flex items-center text-gray-900 text-sm mb-2 cursor-pointer">
                        <input type="checkbox" id="gemini-thinking-enabled" class="mr-2 w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500" />
                        Enable Thinking
                    </label>
                    <p class="text-xs text-gray-600 mt-1 text-left leading-relaxed ml-6">
                        Show AI reasoning process
                    </p>
                </div>
                <div class="mb-4 ml-6">
                    <label class="block text-gray-900 text-sm mb-2 text-left font-medium" for="gemini-thinking-budget">
                        Thinking Budget:
                    </label>
                    <input 
                        type="number"
                        id="gemini-thinking-budget" 
                        class="settings-input w-full p-3 border border-gray-300 rounded bg-white text-gray-900 text-sm box-border transition-colors duration-200 focus:outline-none focus:border-blue-500" 
                        placeholder="Leave empty for dynamic thinking"
                    />
                    <p class="text-xs text-gray-600 mt-2 text-left leading-relaxed">
                        Maximum tokens for thinking (optional, leave empty for Google's dynamic thinking)
                    </p>
                </div>
            </div>

            <div class="mb-6 border-t border-gray-300 pt-4">
                <h3 class="text-gray-900 text-base font-medium mb-3">Initial Greeting</h3>
                <div class="mb-4">
                    <label class="flex items-center text-gray-900 text-sm mb-2 cursor-pointer">
                        <input type="checkbox" id="gemini-initial-greeting-enabled" class="mr-2 w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500" />
                        Enable Initial Greeting
                    </label>
                </div>
                <div class="mb-4 ml-6">
                    <label class="block text-gray-900 text-sm mb-2 text-left font-medium" for="gemini-initial-greeting-message">
                        Greeting Message:
                    </label>
                    <textarea 
                        id="gemini-initial-greeting-message" 
                        class="settings-textarea w-full min-h-[100px]" 
                        placeholder="Enter initial greeting message..."
                    ></textarea>
                    <p class="text-xs text-gray-600 mt-2 text-left leading-relaxed">
                        Message to play when connection is established
                    </p>
                </div>
            </div>

            <div class="mb-6 border-t border-gray-300 pt-4">
                <h3 class="text-gray-900 text-base font-medium mb-3">Voice Activity Detection (VAD)</h3>
                <p class="text-xs text-gray-600 mb-4 text-left leading-relaxed">
                    Controls how the system detects when you start and stop speaking
                </p>
                
                <div class="mb-4">
                    <label class="flex items-center text-gray-900 text-sm mb-2 cursor-pointer">
                        <input type="checkbox" id="gemini-vad-disabled" class="mr-2 w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500" />
                        Disable Automatic VAD
                    </label>
                    <p class="text-xs text-gray-600 mt-1 text-left leading-relaxed ml-6">
                        When disabled, manual control is required for speech detection
                    </p>
                </div>

                <div class="mb-4 ml-6">
                    <label class="block text-gray-900 text-sm mb-2 text-left font-medium" for="gemini-vad-start-sensitivity">
                        Start of Speech Sensitivity:
                    </label>
                    <select id="gemini-vad-start-sensitivity" class="settings-input w-full">
                        <option value="START_SENSITIVITY_LOW">Low - Requires clear, sustained speech (better for noisy environments)</option>
                        <option value="START_SENSITIVITY_MEDIUM" selected>Medium - Balanced detection (default)</option>
                        <option value="START_SENSITIVITY_HIGH">High - Detects even slight sounds (better for quiet environments)</option>
                    </select>
                </div>

                <div class="mb-4 ml-6">
                    <label class="block text-gray-900 text-sm mb-2 text-left font-medium" for="gemini-vad-end-sensitivity">
                        End of Speech Sensitivity:
                    </label>
                    <select id="gemini-vad-end-sensitivity" class="settings-input w-full">
                        <option value="END_SENSITIVITY_LOW">Low - Requires longer silence to end speech</option>
                        <option value="END_SENSITIVITY_MEDIUM" selected>Medium - Balanced detection (default)</option>
                        <option value="END_SENSITIVITY_HIGH">High - Detects end with minimal silence (faster, may cut off speech)</option>
                    </select>
                </div>

                <div class="mb-4 ml-6">
                    <label class="block text-gray-900 text-sm mb-2 text-left font-medium" for="gemini-vad-prefix-padding">
                        Prefix Padding (ms):
                    </label>
                    <input 
                        type="number"
                        id="gemini-vad-prefix-padding" 
                        class="settings-input w-full" 
                        placeholder="20"
                        min="0"
                        max="1000"
                    />
                    <p class="text-xs text-gray-600 mt-2 text-left leading-relaxed">
                        Audio to include before detected speech starts (prevents truncation). Default: 20ms
                    </p>
                </div>

                <div class="mb-4 ml-6">
                    <label class="block text-gray-900 text-sm mb-2 text-left font-medium" for="gemini-vad-silence-duration">
                        Silence Duration (ms):
                    </label>
                    <input 
                        type="number"
                        id="gemini-vad-silence-duration" 
                        class="settings-input w-full" 
                        placeholder="100"
                        min="0"
                        max="5000"
                    />
                    <p class="text-xs text-gray-600 mt-2 text-left leading-relaxed">
                        Duration of silence required to consider speech ended. Default: 100ms
                    </p>
                </div>
            </div>

            <div class="mb-6">
                <button id="save-gemini-config-btn" class="btn-primary btn-blue w-full">
                    üíæ Save Gemini Configuration
                </button>
                <div id="gemini-config-status" class="text-sm text-gray-600 mt-2 min-h-[1.2rem]"></div>
            </div>
        </div>
        
        <!-- Home Assistant Tab Content -->
        <div class="settings-tab-content" id="homeassistant-tab">
            <div class="mb-6">
                <button class="btn-primary btn-green mb-4 w-full" id="extract-ha-config-btn">
                    üîÑ Extract HA Config from Home Assistant
                </button>
                <div id="extract-status" class="text-sm text-gray-600 mt-2 min-h-[1.2rem]"></div>
            </div>
            
            <div class="mb-6 js-hidden" id="ha-config-summary-section">
                <label class="block text-gray-900 text-sm mb-2 text-left font-medium">Extracted Configuration Summary:</label>
                <div id="ha-config-summary" class="ha-config-summary"></div>
            </div>
        </div>
        
        <!-- Docs Tab Content -->
        <div class="settings-tab-content" id="docs-tab">
            <div class="mb-6">
                <p class="text-xs text-gray-600 mt-2 text-left leading-relaxed">
                    Document and reference source configuration will be available here.
                </p>
            </div>
        </div>
        
        <!-- Debug Tab Content -->
        <div class="settings-tab-content" id="debug-tab">
            <div class="mb-6">
                <div class="flex justify-between items-center mb-3">
                    <label class="block text-gray-900 text-sm text-left font-medium" for="ai-function-calls">
                        AI Function Calls (JSON):
                    </label>
                    <button id="copy-log-btn" class="btn-primary btn-blue py-2 px-4">
                        üìã Copy
                    </button>
                </div>
                <textarea 
                    id="ai-function-calls" 
                    class="settings-textarea" 
                    placeholder='AI function calls will appear here when the AI tries to control Home Assistant...'
                    readonly
                ></textarea>
                <p class="text-xs text-gray-600 mt-2 text-left leading-relaxed">
                    This shows the function calls that the AI generates. These will be sent to Home Assistant REST API.
                </p>
            </div>
            
            <div class="mb-6">
                <label class="block text-gray-900 text-sm mb-2 text-left font-medium" for="ha-config-input">
                    Home Assistant Config (JSON):
                </label>
                <textarea 
                    id="ha-config-input" 
                    class="settings-textarea" 
                    placeholder='Paste Home Assistant config JSON here (e.g., from /api/states endpoint)'
                ></textarea>
                <p class="text-xs text-gray-600 mt-2 text-left leading-relaxed">
                    This config will be passed to the AI when connecting. Leave empty to connect without HA context.
                </p>
            </div>
        </div>
    </div>
    
    <div class="text-center text-white w-full max-w-[600px] relative">
        <button class="settings-icon-btn" id="settings-icon" aria-label="Open settings">‚öôÔ∏è</button>
        <h1 class="text-4xl mb-8 font-normal text-white tracking-tight md:text-3xl">TiddeliHome</h1>
        <button id="mic-button" class="mic-button" aria-label="Phone call"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="w-10 h-10 fill-black md:w-9 md:h-9"><path d="M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"/></svg></button>
        <button id="mute-button" class="mute-button min-w-12 h-12 w-12 rounded-full border-none bg-white/10 text-white cursor-pointer shadow-[0_2px_4px_rgba(0,0,0,0.3)] transition-all duration-200 items-center justify-center m-2 mx-auto mt-0 p-0 relative hover:bg-white/20 active:bg-white/15 md:w-11 md:h-11 md:min-w-11" aria-label="Mute microphone">
            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="mute-icon-svg w-8 h-8 fill-white md:w-7 md:h-7">
                <!-- Microphone icon -->
                <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/>
                <path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/>
            </svg>
            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="mute-slash-svg w-8 h-8 absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 md:w-7 md:h-7">
                <!-- Slash line for mute -->
                <line x1="1" y1="23" x2="23" y2="1" stroke="#FFFFFF" stroke-width="2.5" stroke-linecap="round"/>
            </svg>
        </button>
        <p id="status-text" class="text-sm mt-4 text-white/70 font-normal md:text-xs">Ready - Click to start call</p>
    </div>
    <script type="module" src="/src/main.ts"></script>
</body>
</html>
